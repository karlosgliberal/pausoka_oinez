<!DOCTYPE html>
<html>
<head>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
  <script src='//api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.js'></script>
  <link href='//api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.css' rel='stylesheet' />
  <!--[if lte IE 8]>
    <link href='//api.tiles.mapbox.com/mapbox.js/v1.3.1/mapbox.ie.css' rel='stylesheet' >
  <![endif]-->
  <style>
    body { margin:0; padding:0; }
    #map { position:absolute; top:0; bottom:0; width:100%; }
  </style>
</head>
<body>
<div id='map'></div>
<script>

function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
  var R = 6371; // Radius of the earth in km
  var dLat = deg2rad(lat2-lat1);  // deg2rad below
  var dLon = deg2rad(lon2-lon1); 
  var a = 
    Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
    Math.sin(dLon/2) * Math.sin(dLon/2)
    ; 
  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
  var d = R * c; // Distance in km
  return d;
}

function deg2rad(deg) {
  return deg * (Math.PI/180)
}

var aitor =[
      [42.8136921 , -1.5993718],
      [42.8136647 , -1.5993255],
      [42.8136446 , -1.5993376],
      [42.8134258 , -1.599008],
      [42.8134015 , -1.5989568],
      [42.81395   , -1.5984827],
      [42.8146487 , -1.598002],
      [42.8147245 , -1.5979128],
      [42.81458   , -1.5972559],
      [42.8140637 , -1.5965908], //10
      [42.8141961 , -1.5959719],
      [42.814046  , -1.5955554],
      [42.8136521 , -1.5930762],
      [42.8105717 , -1.5864061],
      [42.8104146 , -1.5875713], //15
      [42.8106707 , -1.587327],
      [42.8111594 , -1.6015597],
      [42.810393  , -1.579661],
      [42.810981  , -1.5805932],
      [42.8105541 , -1.5799009],
      [42.8105486 , -1.5798925], //20
      [42.8102094 , -1.579459],
      [42.8103919 , -1.5796611],
      [42.8122659 , -1.5766075],
      [42.8121254 , -1.5742956],
      [42.8063019 , -1.5871991],
      [42.8062616 , -1.5872288],
      [42.8062066 , -1.587317],
      [42.8061379 , -1.5874764],
      [42.7975265 , -1.592748],
      [42.7931027 , -1.5951419],
      [42.7995883 , -1.5947092],
      [42.799587  , -1.5947044],
      [42.7997622 , -1.5944347],
      [42.7997769 , -1.5944589],
      [42.8000349 , -1.5947828],
      [42.8001538 , -1.5949384],
      [42.8001493 , -1.594919],
      [42.8003085 , -1.5954329],
      [42.8003256 , -1.5953072],
      [42.8008893 , -1.5960516],
      [42.8089652 , -1.5959454],
      [42.8085854 , -1.596941],
      [42.8084078 , -1.5972434],
      [42.8072776 , -1.5944537],
      [42.8073005 , -1.5944428],
      [42.8071007 , -1.5944262],
      [42.8070098 , -1.5944736],
      [42.8070156 , -1.5945089],
      [42.8078827 , -1.5964979],
      [42.8085408 , -1.5963796],
      [42.8084807 , -1.5958258],
      [42.8091377 , -1.5959297],
      [42.8090977 , -1.5958799],
      [42.8106297 , -1.5974187],
      [42.8105975 , -1.5972274],
      [42.8109912 , -1.5990642],
];

var points = [
[42.8136757, -1.5991999],
[42.8134853, -1.5987792],
[42.8134968, -1.5985793],
[42.8137038, -1.5984477],
[42.8139589, -1.5984359],
[42.8139591, -1.5981346],
[42.8139523, -1.5980249],
[42.8142343, -1.5978045],
[42.8139766, -1.5981853],
[42.8138799, -1.5979529],
[42.8139197, -1.5980145],
[42.813772, -1.5972446],
[42.8137766, -1.597364],
[42.8138079, -1.5970919],
[42.8139297, -1.59704],
[42.8139644, -1.5968804],
[42.8140009, -1.5968806],
[42.813862, -1.5967861],
[42.8138555, -1.5968326],
[42.8138028, -1.5968728],
[42.8141765, -1.5911244],
[42.8138215, -1.5964851],
[42.8136554, -1.5965696],
[42.8137421, -1.5965945],
[42.8136887, -1.5966156],
[42.8138364, -1.5966116],
[42.8136352, -1.5965787],
[42.8136427, -1.5965959],
[42.8130973, -1.5960959],
[42.8129111, -1.5959924],
[42.8124281, -1.5967807],
[42.8124894, -1.5969026],
[42.8127179, -1.5969393],
[42.8126055, -1.5968856],
[42.8124746, -1.5968932],
[42.8123487, -1.5968752],
[42.8123739, -1.5968969],
[42.8122745, -1.5968884],
[42.8123791, -1.5968985],
[42.8108177, -1.5974283],
[42.8109021, -1.5975197],
[42.8109352, -1.5974954],
[42.8109347, -1.5975506],
[42.8111095, -1.5975852],
[42.8110026, -1.5976158],
[42.8109593, -1.5975108],
[42.8109469, -1.5975259],
[42.8109985, -1.5977608],
[42.8110412, -1.5977897],
[42.8109378, -1.5975078],
[42.8109763, -1.5976904],
[42.8110342, -1.5976227],
[42.811175, -1.5979927],
[42.8111238, -1.5975677],
[42.81106, -1.5976013],
[42.8110433, -1.5975914],
[42.8110666, -1.5978158],
[42.8109629, -1.5976531],
[42.810972, -1.5976489],
[42.8109531, -1.5976065],
[42.811154, -1.5982192],
[42.8111713, -1.5981576],
[42.8111834, -1.5981719],
[42.8111687, -1.5981879],
[42.8110586, -1.5977228],
[42.8110607, -1.597884],
[42.8110125, -1.5978489],
[42.811046, -1.5977134],
[42.810987, -1.5975696],
[42.8110138, -1.5974983],
[42.8108268, -1.5971757],
[42.8107573, -1.5972847],
[42.8108019, -1.5974712],
[42.8108242, -1.5974746],
[42.810766, -1.5975963],
[42.810753, -1.5975027],
[42.8107662, -1.5975952],
[42.8108015, -1.5973518],
[42.810756, -1.5973288],
[42.8107563, -1.5972921],
[42.8107022, -1.5972442],
[42.8094867, -1.6024892],
[42.8106817, -1.5972288],
[42.8106817, -1.5972288],
[42.8108886, -1.5975506],
[42.8111755, -1.5977538],
[42.8111739, -1.5977594],
[42.8111733, -1.597755],
[42.8111231, -1.5979013],
[42.8109722, -1.5973812],
[42.8109577, -1.5973966],
[42.8109801, -1.5973773],
[42.8109035, -1.5973841],
[42.8108642, -1.5974535],
[42.8109576, -1.5977746],
[42.8108996, -1.5975476],
[42.8108052, -1.5975318],
[42.8108099, -1.5976114],
[42.8108814, -1.5975762],
[42.8108805, -1.5975351],
[42.8108943, -1.5975093],
[42.8108732, -1.5975815],
[42.8109371, -1.5978578],
[42.8110444, -1.5979443],
[42.8110385, -1.59761],
[42.8110593, -1.5977328],
[42.8109759, -1.5975384],
[42.8109437, -1.5975831],
[42.810863, -1.597496],
[42.8108051, -1.5974898],
[42.8108027, -1.5975473],
[42.8108099, -1.5974777],
[42.8108751, -1.5975937],
[42.8108719, -1.5973731],
[42.8109075, -1.5974269],
[42.8108439, -1.597463],
[42.8108333, -1.5975535],
[42.8108254, -1.5975657],
[42.8108711, -1.5974747],
[42.8108159, -1.5974394],
[42.8108102, -1.5974239],
[42.81078, -1.5974208],
[42.8107931, -1.5974099],
[42.8107921, -1.5974115],
[42.8108333, -1.5974639],
[42.8108223, -1.5974759],
[42.810812, -1.597354],
[42.8109028, -1.5972426],
[42.8108811, -1.597394],
[42.8107921, -1.5973955],
[42.8107757, -1.5973599],
[42.8108201, -1.5973044],
[42.8107936, -1.5974038],
[42.8107749, -1.5974535],
[42.8107801, -1.5974018],
[42.8107667, -1.5974055],
[42.8107858, -1.5973027],
[42.8107728, -1.5973524],
[42.8107692, -1.5972046],
[42.8109163, -1.5974198],
[42.8109329, -1.5974958],
[42.8109179, -1.5974116],
[42.8108467, -1.597399],
[42.810811, -1.5972784],
[42.810884, -1.5974585],
[42.8108912, -1.5974429],
[42.8108722, -1.5973971],
[42.8107777, -1.5974117],
[42.8107704, -1.5973082],
[42.8109752, -1.597412],
[42.8110051, -1.5974215],
[42.8109952, -1.5975535],
[42.8109263, -1.5974984],
[42.8109126, -1.5974131],
[42.8108361, -1.5974642],
[42.8108321, -1.5974177],
[42.8108447, -1.5973773],
[42.8108278, -1.5973892],
[42.8108836, -1.5974593],
[42.8108771, -1.5973452],
[42.8107923, -1.5971131],
[42.8107293, -1.5970677],
[42.8108574, -1.5974367],
[42.8108681, -1.5974657],
[42.8108898, -1.5974036],
[42.8108629, -1.5973198],
[42.810822, -1.5973656],
[42.8109865, -1.5976219],
[42.8109999, -1.5975787],
[42.8110038, -1.5974818],
[42.8109586, -1.5974864],
[42.810801, -1.5974611],
[42.8108484, -1.5976667],
[42.8108498, -1.5976722],
[42.8108813, -1.5974977],
[42.8108815, -1.5974428],
[42.8108347, -1.5972961],
[42.8108316, -1.5973752],
[42.8108064, -1.5972608],
[42.8109835, -1.5974036],
[42.810998, -1.5975405],
[42.8110177, -1.5974663],
[42.8110245, -1.5975048],
[42.8110492, -1.5975149],
[42.8110531, -1.5975293],
[42.8109747, -1.5973608],
[42.8110351, -1.5973888],
[42.8109691, -1.5974994],
[42.8110837, -1.5980081],
[42.8111331, -1.5980737],
[42.8111864, -1.5977453],
[42.8111173, -1.5976391],
[42.8111232, -1.597605],
[42.8109603, -1.5975112],
[42.811017, -1.5977762],
[42.8109496, -1.5974386],
[42.8109917, -1.5974483],
[42.8109851, -1.5975311],
[42.8110208, -1.5975395],
[42.8113005, -1.5974024],
[42.8118396, -1.5971953],
[42.8124325, -1.5970598],
[42.8124905, -1.5970009],
[42.8127062, -1.5970497],
[42.813039, -1.5974677],
[42.8132532, -1.5975488],
[42.8133109, -1.5974532],
[42.8133043, -1.5973931],
[42.8134535, -1.5973911],
[42.8135829, -1.5972116],
[42.8136281, -1.5972004],
[42.8136388, -1.597335],
[42.8136091, -1.597772],
[42.8136139, -1.5977822],
[42.8135732, -1.5981091],
[42.8134179, -1.5984413],
[42.8133522, -1.5984928],
[42.8133125, -1.5985407],
[42.8134536, -1.5984943],
[42.8134678, -1.5985768],
[42.8134202, -1.5987082],
[42.8134691, -1.5987799],
[42.8134664, -1.5988518],
[42.813518, -1.5989589],
[42.8136037, -1.5990992],
[42.8136688, -1.5991923],
[42.8136342, -1.5991759],
[42.8136641, -1.5992037],
[42.813644, -1.5992608],
[42.813647, -1.5992755],
[42.8136413, -1.5992518],
[42.8136437, -1.5992483],
[42.8136412, -1.5992489],
[42.8136412, -1.5992489],
[42.8136412, -1.5992489],
[42.8136409, -1.5992461],
[42.8136407, -1.5992417],
[42.8136407, -1.5992483],
[42.8136713, -1.5993911],
[42.8137329, -1.5995619],
[42.8137245, -1.5994924],
];

var puntosPekes = [
[42.8134893, -1.5988108],
[42.8134681, -1.5987447],
[42.8134559, -1.5985525],
[42.8134526, -1.59846],
[42.8135773, -1.5981516],
[42.813605, -1.5980312],
[42.8136618, -1.598039],
[42.8136646, -1.5978955],
[42.813659, -1.597746],
[42.8136376, -1.5973122],
[42.8135223, -1.5972534],
[42.8134622, -1.5972287],
[42.8131635, -1.5974061],
[42.812714, -1.5974054],
[42.8124902, -1.5972944],
[42.8116469, -1.597262],
[42.8111727, -1.597563],
[42.8111737, -1.597639],
[42.8110148, -1.5978865],
[42.8111446, -1.5983366],
[42.8111539, -1.5984226],
[42.8116634, -1.6002327],
[42.8125911, -1.599125],
[42.812451, -1.5992116],
[42.8126158, -1.5991602],
[42.8130444, -1.5987838],
[42.8131283, -1.598751],
[42.8131925, -1.5988059],
[42.8134069, -1.5988747]
]; 

var res = getDistanceFromLatLonInKm(42.8136358, -1.5993407, 42.8080106, -1.5863411);
var map = L.mapbox.map('map', 'examples.map-9ijuk24y')
    .setView([42.8090541, -1.5936428], 16);
var marker = [];
var pointInit = {coords: [42.83861717 , -1.6029579]};
window.localStorage.setItem('total', 0);
window.localStorage.setItem('punto', JSON.stringify(pointInit));

for (var i = 0; i < puntosPekes.length; i++) {
  var resultado = window.localStorage.getItem('punto');
  var total = window.localStorage.getItem('total');
  var pointObj = JSON.parse(resultado);
  var res = getDistanceFromLatLonInKm(pointObj.coords[0], pointObj.coords[1], puntosPekes[i][0], puntosPekes[i][1]);
  var totalFloat = parseFloat(total);
  if(res > 0.200){
//    var resultadoTotal = totalFloat + 0.017;
    var resultadoTotal = totalFloat + 0.017;
  }else{
    var resultadoTotal = totalFloat + res;
  }
  console.log(i +': '+ ' dist: '+ res +' total: '+ resultadoTotal + 'lat: ' + puntosPekes[i][0] +' log: '+ puntosPekes[i][1]);

  pointInit = {coords: [puntosPekes[i][0], puntosPekes[i][1]]};
  window.localStorage.setItem('punto', JSON.stringify(pointInit));
  window.localStorage.setItem('total', resultadoTotal);
  marker[i] = L.marker(new L.LatLng(puntosPekes[i][0], puntosPekes[i][1]), {
                  icon: L.mapbox.marker.icon({'marker-color': 'CC0033'}),
                  draggable: true
              });
  marker[i].bindPopup('numero '+ i);
  marker[i].addTo(map);
};

// http://leafletjs.com/reference.html#circle
var circle_options = {
    color: '#fff',      // Stroke color
    opacity: 1,         // Stroke opacity
    weight: 10,         // Stroke weight
    fillColor: '#000',  // Fill color
    fillOpacity: 0.6    // Fill opacity
};

var linea = [
  [42.8136358, -1.5993407],
  [42.8080106, -1.5863411]
]

// Create array of lat,lon points

// Define polyline options
// http://leafletjs.com/reference.html#polyline
var polyline_options = {
    color: '#000'
};

var poloptions = {
    color: 'olive'
};
// Defining a polygon here instead of a polyline will connect the
// endpoints and fill the path.
// http://leafletjs.com/reference.html#polygon
var polyline = L.polyline(aitor, polyline_options).addTo(map);
var polyline2 = L.polyline(linea, poloptions).addTo(map);
</script>
</body>
</html>